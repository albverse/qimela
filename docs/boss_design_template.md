# Boss Monster 设计模板（LimboAI 行为树 + HSM）

> **使用说明**：请填写以下所有表格，AI 将根据这些信息完整实现 Boss。
> 标记 `[必填]` 的为核心字段，标记 `[选填]` 的可留空使用默认值。
> 每个表格附有填写示例供参考。

---

## 0. 目录结构预览（只读，无需填写）

实现后的文件结构将遵循以下规范，与现有代码完全隔离：

```
scene/
  bosses/
    <boss_id>/
      <BossId>.tscn            # Boss 主场景
      <boss_id>.gd             # Boss 主脚本（extends MonsterBase）
      <boss_id>_bt.tres        # LimboAI 行为树资源
      <boss_id>_hsm.tres       # LimboAI HSM 资源（可选）
      tasks/                   # 自定义 BTTask 脚本
        bt_<action_name>.gd    # 每个行为一个文件
      hitboxes/                # 攻击判定区域场景
        <attack_name>_hitbox.tscn
```

---

## 1. Boss 基本信息

| 字段 | 值 | 说明 |
|------|-----|------|
| `boss_id` [必填] | | 英文标识符，用于文件名和 class_name，如 `guardian_golem` |
| `boss_display_name` [必填] | | 显示名称（中文），如 `守护石像` |
| `species_id` [必填] | | 物种 ID（StringName），如 `&"golem_boss"` |
| `attribute_type` [必填] | | `NORMAL` / `LIGHT` / `DARK` |
| `size_tier` [必填] | | `SMALL` / `MEDIUM` / `LARGE` |
| `has_spine` [必填] | | `true` / `false`（是否使用 Spine 动画） |
| `spine_skeleton_path` [选填] | | Spine skeleton 文件路径，如 `res://spine_assets/boss/xxx.json` |
| `collision_shape` [选填] | | 碰撞体形状描述，如 `矩形 64x128` 或 `胶囊 40x100` |

**填写示例**：
> `boss_id` = `stone_guardian` ，`attribute_type` = `DARK`，`size_tier` = `LARGE`

---

## 2. 数值属性

| 属性 | 值 | 默认值 | 说明 |
|------|-----|--------|------|
| `max_hp` [必填] | | `50` | 最大生命值 |
| `weak_hp` [选填] | | `0` | HP 降至该值时进入虚弱（0 = 不会虚弱） |
| `vanish_fusion_required` [选填] | | `1` | 虚弱后需要几次泯灭融合才死亡 |
| `contact_damage` [选填] | | `1` | 接触伤害 |
| `gravity` [选填] | | `1200.0` | 重力（像素/秒²），0 = 不受重力 |
| `move_speed` [必填] | | `80.0` | 基础移动速度（像素/秒） |
| `run_speed` [选填] | | `160.0` | 奔跑/冲刺速度 |
| `jump_force` [选填] | | `-500.0` | 跳跃初速度（负值向上） |
| `facing_player` [选填] | | `true` | 是否始终面向玩家 |
| `hit_stun_time` [选填] | | `0.0` | 受击硬直时间（Boss 通常为 0） |

---

## 3. 阶段定义（Phase / HSM State）

Boss 可以拥有多个阶段，每个阶段有不同的行为模式。LimboAI 中每个阶段对应一个 **HSM State**，每个 State 内部运行一棵 **Behavior Tree**。

| 阶段 ID [必填] | 阶段名称 | HP 触发条件 [必填] | 可用行为列表 [必填] | 特殊规则 [选填] |
|----------------|----------|---------------------|---------------------|----------------|
| `phase_1` | | `hp > 50%` | | |
| `phase_2` | | `hp <= 50%` | | |
| `phase_3` | | `hp <= 25%` | | |

> 按需增减行数。可用行为列表填写**第 5 节**中定义的 `action_id`，用逗号分隔。

**填写示例**：
| 阶段 ID | 阶段名称 | HP 触发条件 | 可用行为列表 | 特殊规则 |
|---------|---------|------------|-------------|---------|
| `phase_1` | 沉稳守卫 | `hp > 60%` | `patrol, slash, guard` | 优先防守，攻击频率低 |
| `phase_2` | 狂暴觉醒 | `hp <= 60%` | `rush, combo_slash, jump_slam, guard` | 攻击频率提高，移速+30% |
| `phase_3` | 垂死挣扎 | `hp <= 20%` | `berserk_combo, dark_wave, jump_slam` | 不再防守，全力进攻 |

---

## 4. Blackboard 变量定义

Blackboard 是 LimboAI 行为树的共享数据层。以下变量将在行为树条件判断中使用。

| 变量名 [必填] | 类型 | 更新时机 [必填] | 说明 |
|---------------|------|----------------|------|
| `target` | `Node2D` | 每帧 | 玩家引用 |
| `distance_to_target` | `float` | 每帧 | 与玩家的距离（像素） |
| `target_dir` | `int` | 每帧 | 玩家方向（-1=左, 1=右） |
| `hp_ratio` | `float` | HP 变化时 | 当前 HP 百分比（0.0~1.0） |
| `is_on_floor` | `bool` | 每帧 | 是否在地面 |
| `target_is_airborne` | `bool` | 每帧 | 玩家是否在空中 |
| | | | |
| | | | |
| | | | |

> 以上预设变量通常都需要保留。请在空行中添加你的 Boss 特有的变量。
> 例如：`guard_break_count` / `rage_meter` / `summon_count` 等。

---

## 5. 行为/动作定义（BTTask）

每个行为是一个独立的 BTTask 脚本。请尽可能详细地描述每个动作。

### 5.1 移动类行为

| `action_id` [必填] | 动作名称 | 动作描述 [必填] | Spine 动画名 [必填] | 持续时间 | 移动方式 |
|---------------------|---------|-----------------|---------------------|---------|---------|
| | | | | | |
| | | | | | |
| | | | | | |

**填写示例**：
| `action_id` | 动作名称 | 动作描述 | Spine 动画名 | 持续时间 | 移动方式 |
|-------------|---------|---------|-------------|---------|---------|
| `patrol` | 巡逻 | 在区域内左右走动 | `walk` | 持续 | 匀速 `move_speed` |
| `chase` | 追击 | 朝玩家方向移动 | `run` | 持续 | 匀速 `run_speed` |
| `retreat` | 后退 | 远离玩家 | `walk_back` | 1.5s | 匀速 `move_speed * 0.5` |
| `jump_to` | 跳向玩家 | 跳跃接近/越过玩家 | `jump` | 动画时长 | 抛物线 |

---

### 5.2 攻击类行为

| `action_id` [必填] | 动作名称 | 动作描述 [必填] | Spine 动画名 [必填] | 伤害 [必填] | 攻击范围 [必填] | 冷却时间 [必填] | 前摇时间 [选填] | 后摇时间 [选填] | 击退力 [选填] |
|---------------------|---------|-----------------|---------------------|------------|----------------|----------------|----------------|----------------|--------------|
| | | | | | | | | | |
| | | | | | | | | | |
| | | | | | | | | | |

> **攻击范围**：描述 hitbox 的形状和相对位置，如 `前方 80x60, 偏移(50, -10)` 或 `圆形 r=120 以自身为圆心`。
> **前摇**：动画开始到实际造成伤害的时间。**后摇**：造成伤害后到可以行动的恢复时间。

**填写示例**：
| `action_id` | 动作名称 | 动作描述 | Spine 动画名 | 伤害 | 攻击范围 | 冷却 | 前摇 | 后摇 | 击退力 |
|-------------|---------|---------|-------------|------|---------|------|------|------|--------|
| `slash` | 横斩 | 原地挥刀一次 | `atk_slash` | `2` | 前方 100x60 | 2s | 0.3s | 0.5s | `300` |
| `combo_slash` | 三连斩 | 连续挥刀三次 | `atk_combo` | `1+1+2` | 前方 100x60 | 5s | 0.2s | 0.8s | `200` |
| `jump_slam` | 跳劈 | 跳起后向下劈砍 | `atk_jump_slam` | `3` | 落点 圆形r=80 | 6s | 0.5s(空中) | 1.0s | `400` |
| `dark_wave` | 暗影波动 | 释放地面波纹向前方扩散 | `skill_dark_wave` | `2` | 前方 300x40 | 8s | 0.6s | 0.4s | `150` |

---

### 5.3 防守/特殊行为

| `action_id` [必填] | 动作名称 | 动作描述 [必填] | Spine 动画名 [必填] | 持续时间 | 效果 [必填] | 触发条件 [选填] | 冷却时间 [选填] |
|---------------------|---------|-----------------|---------------------|---------|------------|----------------|----------------|
| | | | | | | | |
| | | | | | | | |

**填写示例**：
| `action_id` | 动作名称 | 动作描述 | Spine 动画名 | 持续时间 | 效果 | 触发条件 | 冷却 |
|-------------|---------|---------|-------------|---------|------|---------|------|
| `guard` | 防御 | 举盾格挡正面攻击 | `guard_idle` | 最长 3s | 减伤 80%，正面攻击无硬直 | 玩家正在攻击 | 4s |
| `guard_counter` | 弹反 | 防御成功后立刻反击 | `guard_counter` | 动画时长 | 伤害 2，击退 500 | 防御中被攻击 | 跟随 guard |
| `heal` | 自愈 | 回复少量 HP | `cast_heal` | 2s | 回复 max_hp 的 10% | hp < 30% | 15s |
| `roar` | 咆哮 | 全屏震动，击退玩家 | `roar` | 1.5s | 击退范围内的玩家 | 进入 phase_2 时 | 一次性 |

---

## 6. 行为树优先级与决策逻辑

描述每个阶段内，Boss 如何选择行为。这将直接对应 LimboAI 行为树的 Selector/Sequence 结构。

### 阶段：`phase_1`（复制此节为每个阶段各写一份）

| 优先级 (高→低) | 行为 `action_id` | 触发条件 [必填] | 失败后动作 [选填] |
|----------------|-----------------|-----------------|-------------------|
| 1（最高） | | | |
| 2 | | | |
| 3 | | | |
| 4 | | | |
| 5（最低/默认） | | | |

> **触发条件**：用自然语言描述，如 `距离 < 100 且 冷却完成` 或 `玩家正在攻击 且 面向玩家`。
> **失败后动作**：当此行为执行失败时的处理，默认为 `尝试下一优先级`。

**填写示例（phase_1 - 沉稳守卫）**：
| 优先级 | 行为 | 触发条件 | 失败后 |
|--------|------|---------|--------|
| 1 | `guard` | 玩家正在攻击 且 距离 < 150 且 冷却完成 | 跳到 3 |
| 2 | `guard_counter` | 正在 guard 中被命中 | - |
| 3 | `slash` | 距离 < 120 且 冷却完成 | 跳到 4 |
| 4 | `chase` | 距离 > 200 | 跳到 5 |
| 5 | `patrol` | 默认（无其他行为可执行时） | - |

---

## 7. 状态转换规则（Phase 之间）

| 从 [必填] | 到 [必填] | 条件 [必填] | 转换动画 [选填] | 转换期间无敌 [选填] |
|-----------|-----------|------------|----------------|-------------------|
| | | | | |
| | | | | |

**填写示例**：
| 从 | 到 | 条件 | 转换动画 | 无敌 |
|----|-----|------|---------|------|
| `phase_1` | `phase_2` | `hp_ratio <= 0.6` | `roar`（咆哮 1.5s） | `true` |
| `phase_2` | `phase_3` | `hp_ratio <= 0.2` | `transform`（变形 2s） | `true` |

---

## 8. Spine 动画映射总表

将所有用到的 Spine 动画统一列出，确保动画名与 Spine 文件一致。

| 动画名 [必填] | 使用场景 | 轨道（Track） [选填] | 是否循环 [必填] | 混合时间 [选填] |
|---------------|---------|---------------------|----------------|----------------|
| | | | | |
| | | | | |
| | | | | |
| | | | | |
| | | | | |

> **轨道**：Spine 支持多轨道混合，通常 Track 0 = 主体动画，Track 1 = 上半身覆盖。默认 Track 0。
> **混合时间**：动画之间的过渡混合时间（秒），默认 `0.2`。

**填写示例**：
| 动画名 | 使用场景 | 轨道 | 循环 | 混合时间 |
|--------|---------|------|------|---------|
| `idle` | 待机 | 0 | `true` | 0.2 |
| `walk` | 巡逻/行走 | 0 | `true` | 0.2 |
| `run` | 追击 | 0 | `true` | 0.15 |
| `atk_slash` | 横斩攻击 | 0 | `false` | 0.1 |
| `atk_combo` | 三连斩 | 0 | `false` | 0.1 |
| `guard_idle` | 防御持续 | 0 | `true` | 0.1 |
| `guard_counter` | 弹反攻击 | 0 | `false` | 0.05 |
| `hit` | 受击 | 0 | `false` | 0.05 |
| `die` | 死亡 | 0 | `false` | 0.2 |
| `roar` | 阶段转换咆哮 | 0 | `false` | 0.2 |

---

## 9. 音效与特效

| 事件 [必填] | 音效文件路径 [选填] | VFX 描述 [选填] | 备注 |
|------------|-------------------|-----------------|----- |
| | | | |
| | | | |
| | | | |

**填写示例**：
| 事件 | 音效路径 | VFX 描述 | 备注 |
|------|---------|---------|------|
| 横斩命中 | `res://audio/sfx/slash_hit.wav` | 刀光弧线 | |
| 跳劈落地 | `res://audio/sfx/slam.wav` | 地面碎裂+震屏 | shake 0.3s |
| 防御成功 | `res://audio/sfx/guard_clang.wav` | 火花 | |
| 阶段转换 | `res://audio/sfx/roar.wav` | 全屏暗色脉冲 | |
| 死亡 | `res://audio/sfx/boss_die.wav` | 爆炸+碎片 | 掉落物品 |

---

## 10. 受击与被动规则

| 规则 [必填] | 描述 [必填] | 触发条件 [选填] |
|------------|------------|----------------|
| 霸体/Super Armor | | |
| 受击硬直 | | |
| 击退抗性 | | |
| 弱点机制 | | |
| 对锁链的反应 | | |
| 虚弱状态表现 | | |

**填写示例**：
| 规则 | 描述 | 触发条件 |
|------|------|---------|
| 霸体 | Phase 1 攻击中不被打断；Phase 3 全程霸体 | 攻击动画播放中 / Phase 3 |
| 受击硬直 | 仅在 idle/walk 时有 0.1s 硬直 | 非攻击非防御状态 |
| 击退抗性 | 大型 Boss 击退距离减半 | 始终 |
| 弱点 | 攻击后摇期间受到双倍伤害 | 攻击后摇中 |
| 锁链 | 只有虚弱时可被链接，链接时延长虚弱 | `weak == true` |
| 虚弱 | 跪地喘息，闪烁白色 | `hp <= weak_hp` |

---

## 11. 额外说明（自由文本）

> 在这里写下任何上面表格未覆盖到的信息，例如：
> - Boss 战场景的特殊机制（平台、陷阱、场景互动）
> - Boss 出场动画/对话
> - 死亡后的剧情触发
> - 掉落物品
> - 与其他系统的交互（锁链、融合、光照等）
> - 任何你觉得重要但不确定写在哪里的内容

```
（在此自由填写）
```

---

## 附录 A：LimboAI 行为树结构预览（只读参考）

以下是基于你填写的信息，AI 将要构建的行为树结构示意：

```
LimboHSM (Boss 主状态机)
├── Phase1State (BTState)
│   └── BehaviorTree
│       └── BTSelector (优先级选择)
│           ├── BTSequence [Guard]
│           │   ├── BTCondition: 玩家正在攻击?
│           │   ├── BTCondition: 距离 < 150?
│           │   ├── BTCondition: 冷却完成?
│           │   └── BTAction: 执行 Guard
│           ├── BTSequence [Slash]
│           │   ├── BTCondition: 距离 < 120?
│           │   ├── BTCondition: 冷却完成?
│           │   └── BTAction: 执行 Slash
│           ├── BTSequence [Chase]
│           │   ├── BTCondition: 距离 > 200?
│           │   └── BTAction: 执行 Chase
│           └── BTAction: Patrol (默认)
│
├── Phase2State (BTState)
│   └── BehaviorTree (更激进的行为树)
│
├── Phase1→Phase2 Transition
│   └── Condition: hp_ratio <= 0.6
│
└── Phase2→Phase3 Transition
    └── Condition: hp_ratio <= 0.2
```

---

## 附录 B：Checklist（AI 填写，你无需操作）

实现时 AI 将逐项完成：

- [ ] 安装/确认 LimboAI 插件
- [ ] 创建 Boss 目录结构
- [ ] 编写 Boss 主脚本（extends MonsterBase）
- [ ] 配置 Blackboard 变量
- [ ] 编写每个 BTTask 脚本
- [ ] 构建各阶段 BehaviorTree
- [ ] 配置 HSM 阶段转换
- [ ] 设置 Hitbox/Hurtbox
- [ ] 绑定 Spine 动画
- [ ] 绑定音效/特效
- [ ] 构建 Boss .tscn 场景
- [ ] 集成测试
